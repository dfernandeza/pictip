/*! Pictip - v0.3.0 @dfernandeza */
!function(a){var b=function(a,b){this.index=a,this.top=b.top,this.left=b.left,this.tooltip=null,this.open=!1};b.prototype.create=function(a,b){var c=b.clone();return c.css({position:"absolute",top:this.top,left:this.left,display:"none"}).addClass("spot-"+a).data({index:a}),c},b.prototype.openToolTip=function(a,b,c){var d=this.index,e=a.find(".spot-"+d),f=a.find(".spot-tooltip-"+d);this.open=!0,e.addClass("spot-open"),this.tooltip.isbubble&&f.css(this.tooltip.getCoords(e,f)),"function"==typeof b?b(f):f.fadeIn(200,function(){"function"==typeof c&&c(e[0],this)})},b.prototype.closeToolTip=function(a,b,c){var d=this.index,e=a.find(".spot-"+d),f=a.find(".spot-tooltip-"+d);this.open=!1,e.removeClass("spot-open"),"function"==typeof b?b(f):f.fadeOut(200,function(){"function"==typeof c&&c(e[0],this)})};var c=function(a,b,c){this.index=a,this.position=b.tooltipPosition,this.id=b.tooltipId,this.css=b.tooltipCss,this.close=b.tooltipClose,this.content=b.content,this.isbubble=c};c.prototype.create=function(){var b=a("<div/>",{id:this.id,"class":"spot-tooltip spot-tooltip-"+this.index}),c=this.close?a("<a/>",{"class":"spot-tooltip-close",href:"#",text:"X"}):a(),d=a("<div/>",{"class":"spot-tooltip-content"}),e={},f={};return d.html(this.content),b.append(c,d).data("index",this.index),this.isbubble||(e={top:0,left:0,width:"100%"}),f=a.extend(e,this.css),b.css(f),b},c.prototype.getCoords=function(a,b){var c=0,d=0,e=this.position,f=a.position(),g=f.top,h=f.left,i=a.outerHeight(),j=a.outerWidth(),k=b.outerHeight(),l=b.outerWidth(),m=j/2;return b.addClass("spot-tooltip-"+e),"tl"===e&&(c=g-k+m,d=h-l+m),"tr"===e&&(c=g-k+m,d=h+j-m),"tc"===e&&(c=g-k+m,d=h-(l/2-j/2)),"bl"===e&&(c=g+i-m,d=h-l+m),"br"===e&&(c=g+i-m,d=h+j-m),"bc"===e&&(c=g+i-m,d=h-(l/2-j/2)),"cl"===e&&(c=g-(k/2-i/2),d=h-l+m),"cr"===e&&(c=g-(k/2-i/2),d=h+j-m),{top:c,left:d}};var d=function(d){var e=a(d),f={},g=[],h=function(){var b=this;e.on("click",function(a){a.preventDefault(),b.closeToolTips()}),e.on("click",".spot-tooltip",function(a){a.stopPropagation()}),e.on("click",".spot-tooltip-close",function(b){b.preventDefault(),b.stopPropagation(),g[a(this).parent(".spot-tooltip").data("index")].closeToolTip(e,f.close,f.onCloseToolTip)}),e.on(f.eventType,f.spotClass,function(c){c.preventDefault(),c.stopPropagation();var d=a(this);d.hasClass("spot-open")?g[d.data("index")].closeToolTip(e,f.close,f.onCloseToolTip):(b.closeToolTips(),g[d.data("index")].openToolTip(e,f.show,f.onShowToolTip))})};this.closeToolTips=function(){for(var a=0;a<g.length;a++)g[a].open&&g[a].closeToolTip(e,f.close,f.onCloseToolTip)},this.destroy=function(){this.closeToolTips(),e.off("click").off(f.eventType),e.find(f.spotClass).remove(),e.find(".spot-tooltip").remove()},this.init=function(d){f=a.extend({},a.fn.pictip.options,d),this.destroy();var i,j=0,k=[],l=[],m=a(f.spotTemplate).addClass(f.spotClass.replace(".","")),n=null,o=null,p=null;for(j=0;j<f.spots.length;j++)n=new b(j,f.spots[j]),p=new c(j,f.spots[j],f.tooltip),n.tooltip=p,o=n.create(j,m),g.push(n),k.push(o),i=p.create(),l.push(i);e.append(k,l),e.find(f.spotClass).fadeIn(200),h.call(this)},e.data("pictip",this)};a.fn.pictip=function(a){return this.each(function(){new d(this).init(a)})},a.fn.pictip.options={spots:[],spotClass:".spot",spotTemplate:'<a href="#"></a>',eventType:"click",tooltip:!0,show:null,close:null,onShowToolTip:null,onCloseToolTip:null}}(jQuery);