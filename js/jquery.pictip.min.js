(function($){var Spot=function(index,conf){this.index=index;this.top=conf.top;this.left=conf.left;this.tooltip=null};Spot.prototype.create=function(index,$template){var $spot=$template.clone();$spot.css({position:"absolute",top:this.top,left:this.left,display:"none"}).addClass("spot-"+index).data({"index":index});return $spot};Spot.prototype.openToolTip=function(onShow){var index=this.index,$spot=$(".spot-"+index),$tooltip=$(".spot-tooltip-"+index);if(this.tooltip.isbubble)$tooltip.css(this.tooltip.getCoords($spot,
$tooltip));$tooltip.fadeIn(200,function(){onShow($spot[0],this)})};Spot.prototype.closeToolTip=function(onClose){var index=this.index,$spot=$(".spot-"+index);$spot.removeClass("spot-open");$(".tooltip-"+index).fadeOut(200,function(){onClose($spot[0],this)})};var ToolTip=function(index,conf,isbubble){this.index=index;this.position=conf.tooltipPosition;this.id=conf.tooltipId;this.css=conf.tooltipCss;this.close=conf.tooltipClose;this.content=conf.content;this.isbubble=isbubble};ToolTip.prototype.create=
function(){var $tt=$("<div/>",{"id":this.id,"class":"spot-tooltip spot-tooltip-"+this.index}),$ttClose=this.close?$("<a/>",{"class":"spot-tooltip-close","href":"#","text":"X"}):$(),$ttContent=$("<div/>",{"class":"spot-tooltip-content"}),pluginCss={},customCss={};$ttContent.html(this.content);$tt.append($ttClose,$ttContent).data("index",this.index);if(!this.isbubble)pluginCss={top:0,left:0,width:"100%"};customCss=$.extend(pluginCss,this.css);$tt.css(customCss);return $tt};ToolTip.prototype.getCoords=
function($spot,$tooltip){var top=0,left=0,position=this.position,spotPosition=$spot.position(),spotTop=spotPosition.top,spotLeft=spotPosition.left,spotHeight=$spot.outerHeight(),spotWidth=$spot.outerWidth(),tooltipHeight=$tooltip.outerHeight(),tooltipWidth=$tooltip.outerWidth(),relocation=spotWidth/2;if(position==="tl"){top=spotTop-tooltipHeight+relocation;left=spotLeft-tooltipWidth+relocation}if(position==="tr"){top=spotTop-tooltipHeight+relocation;left=spotLeft+spotWidth-relocation}if(position===
"tc"){top=spotTop-tooltipHeight+relocation;left=spotLeft-(tooltipWidth/2-spotWidth/2)}if(position==="bl"){top=spotTop+spotHeight-relocation;left=spotLeft-tooltipWidth+relocation}if(position==="br"){top=spotTop+spotHeight-relocation;left=spotLeft+spotWidth-relocation}if(position==="bc"){top=spotTop+spotHeight-relocation;left=spotLeft-(tooltipWidth/2-spotWidth/2)}if(position==="cl"){top=spotTop-(tooltipHeight/2-spotHeight/2);left=spotLeft-tooltipWidth+relocation}if(position==="cr"){top=spotTop-(tooltipHeight/
2-spotHeight/2);left=spotLeft+spotWidth-relocation}return{top:top,left:left}};var PicTip=function(el){var $el=$(el),opts={},spots=[],attachEventHandlers=function(){var self=this;$el.on("click",function(e){e.preventDefault();self.closeToolTips()});$el.on("click",".spot-tooltip",function(e){e.stopPropagation()});$el.on("click",".spot-tooltip-close",function(e){e.preventDefault();e.stopPropagation();$el.find(opts.spotClass).removeClass("spot-open");$(this).parent(".spot-tooltip").fadeOut(200,function(){spots[$(this).data("index")].closeToolTip(opts.onCloseToolTip)})});
$el.on(opts.eventType,opts.spotClass,function(e){e.preventDefault();e.stopPropagation();var $this=$(this),$tooltip=$el.find(".spot-tooltip-"+$this.data("index"));$el.find(".spot-tooltip").not($tooltip).fadeOut(200);opts.onCloseToolTip($(".spot-open")[0],$(".spot-tooltip")[0]);$el.find(opts.spotClass).not($this).removeClass("spot-open");if(!$this.hasClass("spot-open"))spots[$this.data("index")].openToolTip(opts.onShowToolTip);else{$tooltip.fadeOut(200);opts.onCloseToolTip(this,$tooltip[0])}$this.toggleClass("spot-open")})};
this.closeToolTips=function(){$(opts.spotClass).removeClass("spot-open");$el.find(".spot-tooltip").fadeOut(200,function(){var index=$(this).data("index");opts.onCloseToolTip($(".spot-"+index)[0],this)})};this.destroy=function(){this.closeToolTips();$el.off("click").off(opts.eventType);$el.find(opts.spotClass).remove();$el.find(".spot-tooltip").remove()};this.init=function(options){opts=$.extend({},$.fn.pictip.options,options);this.destroy();var i=0,$spots=[],$tooltips=[],spotTemplate=$(opts.spotTemplate).addClass(opts.spotClass.replace(".",
"")),spot=null,$spot=null,tooltip=null,$tooltip;for(i=0;i<opts.spots.length;i++){spot=new Spot(i,opts.spots[i]);tooltip=new ToolTip(i,opts.spots[i],opts.tooltip);spot.tooltip=tooltip;$spot=spot.create(i,spotTemplate);spots.push(spot);$spots.push($spot);$tooltip=tooltip.create();$tooltips.push($tooltip)}$el.append($spots,$tooltips);$el.find(opts.spotClass).fadeIn(200);attachEventHandlers.call(this)};$el.data("pictip",this)};$.fn.pictip=function(options){return this.each(function(){(new PicTip(this)).init(options)})};
$.fn.pictip.options={spots:[],spotClass:".spot",spotTemplate:"<a href='#'></a>",eventType:"click",tooltip:true,onShowToolTip:function(spot,tooltip){},onCloseToolTip:function(spot,tooltip){}}})(jQuery);